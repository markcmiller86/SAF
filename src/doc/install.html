<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.51
     from install.texi on 30 November 1999 -->

<TITLE>SAF Software Suite Configuration and Building</TITLE>
</HEAD>
<BODY>
<H1>SAF Software Suite</H1>
<H2>Configuration and Building</H2>
<ADDRESS>Robb Matzke</ADDRESS>
<P>
<P><HR><P>
<H1>Table of Contents</H1>
<UL>
<LI><A NAME="TOC1" HREF="install.html#SEC1">Installation</A>
<UL>
<LI><A NAME="TOC2" HREF="install.html#SEC2">Obtaining the Software</A>
<LI><A NAME="TOC3" HREF="install.html#SEC3">Unpacking the Software</A>
<LI><A NAME="TOC4" HREF="install.html#SEC4">Configuration</A>
<UL>
<LI><A NAME="TOC5" HREF="install.html#SEC5">Environment Variables</A>
<LI><A NAME="TOC6" HREF="install.html#SEC6">Configure Switches</A>
</UL>
<LI><A NAME="TOC7" HREF="install.html#SEC7">Building</A>
<LI><A NAME="TOC8" HREF="install.html#SEC8">Testing</A>
<LI><A NAME="TOC9" HREF="install.html#SEC9">Installing</A>
</UL>
<LI><A NAME="TOC10" HREF="install.html#SEC10">Development</A>
<UL>
<LI><A NAME="TOC11" HREF="install.html#SEC11">Overview</A>
<LI><A NAME="TOC12" HREF="install.html#SEC12">Make Targets</A>
<LI><A NAME="TOC13" HREF="install.html#SEC13">The Makefile.in Files</A>
<UL>
<LI><A NAME="TOC14" HREF="install.html#SEC14">Recursion</A>
<LI><A NAME="TOC15" HREF="install.html#SEC15">Public Header Files</A>
<LI><A NAME="TOC16" HREF="install.html#SEC16">Libraries</A>
<LI><A NAME="TOC17" HREF="install.html#SEC17">Test Suite</A>
<LI><A NAME="TOC18" HREF="install.html#SEC18">Tools</A>
<LI><A NAME="TOC19" HREF="install.html#SEC19">Cleanup</A>
</UL>
<LI><A NAME="TOC20" HREF="install.html#SEC20">Feature Testing</A>
</UL>
<LI><A NAME="TOC21" HREF="install.html#SEC21">Frequently Asked Questions</A>
<UL>
<LI><A NAME="TOC22" HREF="install.html#SEC22">Infinite loops during make</A>
<LI><A NAME="TOC23" HREF="install.html#SEC23">Library not Rebuilt</A>
<LI><A NAME="TOC24" HREF="install.html#SEC24">Debugging Shared Libraries</A>
</UL>
</UL>
<P><HR><P>


<H1><A NAME="SEC1" HREF="install.html#TOC1">Installation</A></H1>

<P>
This section describes how one installs the libraries, header files,
and tools of the SAF software suite.

</P>



<H2><A NAME="SEC2" HREF="install.html#TOC2">Obtaining the Software</A></H2>

<P>
[Not written yet.]

</P>


<H2><A NAME="SEC3" HREF="install.html#TOC3">Unpacking the Software</A></H2>

<P>
The SAF software suite is distributed as a compressed <CODE>tar</CODE> file which
will expand into a directory named like <TT>`saf-1.0'</TT>. This directory will
contain top-level configuration and documentation and each of the other
packages will appear as a subdirectory.

</P>

<PRE>
$ gunzip &#60;saf-1.0 |tar xf -
$ cd saf-1.0
</PRE>

<DL COMPACT>

<DT><TT>`Dependencies'</TT>
<DD>
A file listing the dependencies for the object files whose source files
are in this directory.  All directories have this file although it's
empty when the directory doesn't contain any source files.

<DT><TT>`Makefile.in'</TT>
<DD>
The input files that <CODE>configure</CODE> uses to generate each
<TT>`Makefile'</TT>. Each directory has one of these files.

<DT><TT>`README'</TT>
<DD>
Instructions for obtaining further instructions.

<DT><TT>`acconfig.h'</TT>
<DD>
List of potential features available in C source code. The actual list
of features will be generated by <CODE>configure</CODE> and placed in the
<TT>`include/SAFconfig.h'</TT> file.

<DT><TT>`aclocal.m4'</TT>
<DD>
Macros that <CODE>m4</CODE> uses to detect how to build shared libraries.

<DT><TT>`config'</TT>
<DD>
A directory of configuration-related files.

<DT><TT>`configure'</TT>
<DD>
The main configuration shell script.

<DT><TT>`configure.in'</TT>
<DD>
The input used to generate the <TT>`configure'</TT> script.

<DT><TT>`safapi'</TT>
<DD>
The SAF API package.

<DT><TT>`doc'</TT>
<DD>
Top-level documentation. Each package may also have its own
documentation.

<DT><TT>`dsl'</TT>
<DD>
The DSL package.

<DT><TT>`include'</TT>
<DD>
Header files needed to compile various packages. Most of these are
symlinks to the real header file in the package that defines it.

<DT><TT>`vbt'</TT>
<DD>
The VBT package.
</DL>



<H2><A NAME="SEC4" HREF="install.html#TOC4">Configuration</A></H2>

<P>
All SAF software packages can be compiled either within the source tree or in
separate directories. The directory hierarchy where the SAF source code is
located is called the <STRONG>source tree</STRONG> and the directory hierarchy where SAF
software is built is called the <STRONG>build tree</STRONG>. Some advantages of using a
build tree separate from the source tree are that the source tree is not
polluted with generated files, a failed build attempt can be easily cleaned up
by removing the entire build tree, and numerous configurations of SAF can be
compiling simultaneously (such as serial and parallel, debug and production
versions).

</P>
<P>
To configure SAF software the user should create a build directory (if other
than the root of the SAF source tree) and <CODE>cd</CODE> into that directory. Most
users can simply run <CODE>configure</CODE> at this point in order to detect
characteristics of the host and compiler and generate the makefiles. However,
the behavior of <CODE>configure</CODE> can be influenced with various environment
variables and command-line switches:

</P>
<P>
Example: the source tree is <TT>`/usr/src/saf-1.0'</TT> and the build tree is
<TT>`/tmp/build/saf-1.0/plain'</TT>.

</P>

<PRE>
$ mkdir -p /tmp/build/saf-1.0/plain
$ cd /tmp/build/saf-1.0/plain
$ CC=mpicc CPPFLAGS=-I$HOME/include LDFLAGS=-L$HOME/lib \
  /usr/src/saf-1.0/configure --enable-production
</PRE>

<P>
Some users like to create a shell script in the root of the source tree 
so they don't have to remember all the environment variables and
switches. An example is a shell script called <TT>`config.robb'</TT> which
the author uses:

</P>

<PRE>
#!/bin/sh

# Configure is in the same directory as this script.
configure=`echo $0 |sed s/config.robb/configure/`

env \
    CPPFLAGS="$CPPFLAGS -I$HOME/include" \
    LDFLAGS="$LDFLAGS -L$HOME/lib" \
    $configure --prefix=$HOME "$@"
</PRE>



<H3><A NAME="SEC5" HREF="install.html#TOC5">Environment Variables</A></H3>

<P>
These environment variables affect the behavior of <CODE>configure</CODE>:

</P>
<DL COMPACT>

<DT><CODE>CC</CODE>
<DD>
The name of the C compiler. The default is <CODE>cc</CODE> or, preferably,
<CODE>gcc</CODE>. If the compiler base name is <CODE>mpicc</CODE> or <CODE>mpcc</CODE> then
parallel versions of all SAF software will be created (there are other ways to
specify a parallel library when a C compiler wrapper is not available).


<PRE>
$ CC=/usr/local/mpich/bin/mpicc ./configure
$ CC='cc -n32' ./configure
</PRE>

<DT><CODE>CFLAGS</CODE>
<DD>
This variable contains the command-line switches which will be passed to the C
compiler. Any value specified here will be augmented with additional switches
detected during the configuration process.


<PRE>
$ CFLAGS=-fullwarn ./configure
</PRE>

<DT><CODE>CPPFLAGS</CODE>
<DD>
These are the command-line switches for the C preprocessor and will be
supplied to the C compiler in addition to the <CODE>$CFLAGS</CODE> value when
compiling a C source file into an object file.


<PRE>
$ CPPFLAGS="-DNDEBUG -I/usr/ncsa/include" ./configure
</PRE>

<DT><CODE>LDFLAGS</CODE>
<DD>
These are the flags to pass to the linker (via the compiler) in addition to
the flags determined by <CODE>configure</CODE>.


<PRE>
$ LDFLAGS=-L/usr/ncsa/lib ./configure
</PRE>

<DT><CODE>MAKE</CODE>
<DD>
The name of the <CODE>make</CODE> command, defaulting to <CODE>make</CODE>. All common
versions of Unix <CODE>make</CODE> are supported although certain versions have
crippled functionality (for instance, Irix <CODE>make</CODE> is unable to build SAF
software when the build tree is other than the source tree, but Irix
<CODE>pmake</CODE> is fully supported).  Obviously, if a value other than
<CODE>make</CODE> is specified then the specified version of make must be used to
build the software.

<DT><CODE>TEST_FILE_PATH</CODE>
<DD>
This is the name of a directory where the test suite will create its test files. The default is <TT>`.'</TT>, meaning that each test file will be created in the same directory as the test program.


<PRE>
$ MAKE=gmake ./configure
$ gmake
</PRE>

</DL>



<H3><A NAME="SEC6" HREF="install.html#TOC6">Configure Switches</A></H3>

<P>
These <CODE>configure</CODE> switches affect how things are detected:

</P>
<DL COMPACT>

<DT><CODE>--prefix=<VAR>prefix</VAR></CODE>
<DD>
Building the software suite results in headers, libraries, and tools which are
initially created in the build tree. Issuing the <CODE>make install</CODE> command
will copy these public files to directories named <TT>`include'</TT>, <TT>`lib'</TT>,
and <TT>`bin'</TT> under the <VAR>prefix</VAR> directory, which must already exist. The
default prefix is <TT>`/usr/local'</TT>.  <B>The prefix should not be an
existing directory in the build or source tree.</B> Note: shared libraries must
generally be installed before they can be used.


<PRE>
$ ./configure --prefix=$HOME
</PRE>

<DT><CODE>--enable-production</CODE>
<DD>
All source code is compiled for debugging by default (no optimizations and the
<SAMP>`-g'</SAMP> compiler flag specified). Giving this switch will cause symbolic
debugging to be disabled and full optimizations turned on. It is also possible
to configure all software for profiling by saying
<CODE>--enable-production=profile</CODE>.

<DT><CODE>--with-zlib=<VAR>incdir</VAR>,<VAR>libdir</VAR></CODE>
<DD>
<DT><CODE>--without-zlib</CODE>
<DD>
If HDF5 is one of the packages distributed with the SAF software (as opposed
to being already installed on the system) then this switch can be used to
indicate where the ZLIB headers and library are located if they're in a
nonstandard location. Alternatively, saying <CODE>--without-zlib</CODE> will prevent
HDF5 from using it even when it's installed on the system (so applications
don't have to link with <CODE>-lz</CODE>).

<DT><CODE>--enable-shared</CODE>
<DD>
If this switch is supplied then the makefiles will be set up to generate both
static and shared libraries. Shared libraries have not been tested extensively
and some systems are unable to link an executable against multiple shared
libraries unless the libraries have been installed in their final home with
<CODE>make install</CODE>.

<DT><CODE>--enable-parallel=<VAR>style</VAR></CODE>
<DD>
Normally a parallel library is built if the <CODE>CC</CODE> environment variable
contains a name recognized as a parallel compiler. However, if such a compiler
is unavailable then one may turn on the parallel features of the library by
supplying this option. The only currently valid <VAR>style</VAR> is <SAMP>`mpich'</SAMP>.

The following two commands are equivalent:

<PRE>
$ CC=mpicc ./configure
$ ./configure --enable-parallel=mpich
</PRE>

<DT><CODE>--help</CODE>
<DD>
This switch will print <CODE>configure</CODE> usage information.

</DL>



<H2><A NAME="SEC7" HREF="install.html#TOC7">Building</A></H2>

<P>
The public header files, libraries, tools, and test suite are built by
going to the top of the build tree and saying <CODE>make</CODE><A NAME="DOCF1" HREF="install.html#FOOT1">(1)</A>. The included packages will be built
from the bottom up and the build will immediately fail if anything goes
wrong.

</P>
<P>
Individual packages can be compiled by changing directories into the package
(or the package's <TT>`lib'</TT>, <TT>`test'</TT>, or <TT>`tools'</TT> directories) and
saying <CODE>make</CODE> at that point.

</P>


<H2><A NAME="SEC8" HREF="install.html#TOC8">Testing</A></H2>

<P>
The entire test suite can be run by going to the top of the build tree and
issuing the <CODE>make check</CODE> command. Individual packages may be tested by
entering the appropriate directory and issuing the <CODE>make check</CODE> command
there. The test suite will immediately fail if any particular test
fails.

</P>


<H2><A NAME="SEC9" HREF="install.html#TOC9">Installing</A></H2>

<P>
Although the header files and static libraries can be used directly from the
build tree, it is usually more conventient to install them in a common
location. In fact, some systems require that the shared libraries be installed
before being used.

</P>
<P>
The <CODE>make install</CODE> command will install the public headers, libraries,
and tools of the build tree and can be issued in a subdirectory to install
only that subdirectory and its descendents.

</P>
<P>
The headers are installed in <TT>`<VAR>prefix</VAR>/include'</TT>, the libraries in
<TT>`<VAR>prefix</VAR>/lib'</TT>, and the tools in <TT>`<VAR>prefix</VAR>/bin'</TT>. The
<VAR>prefix</VAR> is either <TT>`/usr/local'</TT> or the value specified for the 
<CODE>--prefix</CODE> <CODE>configure</CODE> switch.

</P>


<H1><A NAME="SEC10" HREF="install.html#TOC10">Development</A></H1>

<P>
This chapter describes how the configuration system works, how it can be used
by developers of SAF software, and how it can be extended.

</P>



<H2><A NAME="SEC11" HREF="install.html#TOC11">Overview</A></H2>

<P>
The SAF software suite uses GNU <CODE>autoconf</CODE>, which has two halves.The
first half runs on a system with the <CODE>autoconf</CODE> tools and generates a
portable Bourne shell script called <CODE>configure</CODE> and a pre-header file
called <TT>`include/SAFconfig.h.in'</TT> which contains the list of potential
features.  Input files to this phase are <TT>`configure.in'</TT> which contains
most of the specialization, <TT>`aclocal.m4'</TT> which contains various functions 
including code to detect how to build shared libraries, and <TT>`acconfig.h'</TT>
which contains C preprocessor definitions for potential features which are not 
detected automatically by configure.

</P>
<P>
The commands <CODE>autoheader</CODE> and <CODE>autoconf</CODE> are run without arguments
in the top of the source tree (the directory which contains the input files).
The graphs below append an asterisk to indicate executable scripts and bracket
generated files.

</P>
<P>
Files used in preparing a software package for distribution:

</P>

<PRE>
configure.in aclocal.m4 acconfig.h
     |            |          |
     `------------+----------'
                  |
         .--------+------.
         |               |
         v               v
   [configure*]  [SAFconfig.h.in]
</PRE>

<P>
The build host does not need the GNU autoconf tools. It runs the portable (but 
nearly unreadable) <CODE>configure</CODE> script which generates three files:
<TT>`config.cache'</TT> caches the results from run to run, <TT>`config.log'</TT>
contains information about things that failed, and <TT>`config.status'</TT> is a
shell script. The final action of <CODE>configure</CODE> is to run
<CODE>config.status</CODE>, which creates the build tree (if it doesn't exist) and
populates it by creating a <TT>`Makefile'</TT> in each build directory that had a
<TT>`Makefile.in'</TT> in the corresponding source directory. The
<CODE>config.status</CODE> also creates/updates the <TT>`include/SAFconfig.h'</TT> file
which is included by all SAF packages and contains the results of the
configuration.

</P>
<P>
Files used in configuring a software package:

</P>

<PRE>
[configure*]
     |
     |               [SAFconfig.h.in]  Makefile.in
     |                       |              |
     +---------------.       `-------+------'
     |               +---------.     |
     v               v         v     v
[config.cache]  [config.log]  [config.status*]
                                     |
                              .------+------.
                              |             |
                              v             v
                        [SAFconfig.h]    [Makefile]
</PRE>

<P>
In order to reconfigure with different environment variables and/or
switches it's necessary to remove the <TT>`config.cache'</TT> file first.

</P>


<H2><A NAME="SEC12" HREF="install.html#TOC12">Make Targets</A></H2>

<P>
The following targets are understood in all directories that
contain a makefile:

</P>
<DL COMPACT>

<DT><CODE>all</CODE>
<DD>
This is the default if no target is supplied and results in
building all libraries, test cases, and tools.

<DT><CODE>tests</CODE>
<DD>
<DT><CODE>tests_here</CODE>
<DD>
This target builds all libraries, tools, and test cases (because
the test cases depend on the libraries and tools). The
<CODE>tests_here</CODE> target is not recursive.

<DT><CODE>_tools</CODE>
<DD>
<DT><CODE>_tools_here</CODE>
<DD>
This target builds all libraries and tools, but not test
cases.<A NAME="DOCF2" HREF="install.html#FOOT2">(2)</A> The <CODE>_tools_here</CODE> target is
not recursive.

<DT><CODE>libs</CODE>
<DD>
<DT><CODE>libs_here</CODE>
<DD>
This target builds all libraries, public and private, but neither test
cases nor tools. The <CODE>libs_here</CODE> target is not recursive.

<DT><CODE>check</CODE>
<DD>
<DT><CODE>check_here</CODE>
<DD>
This target builds everything and then runs the test suite.  The
<CODE>check_here</CODE> target is not recursive.

<DT><CODE>install</CODE>
<DD>
This target builds everything and then installs the public headers, 
libraries, and tools in the subdirectories <TT>`include'</TT>, <TT>`lib'</TT>, 
and <TT>`bin'</TT> of the <VAR>prefix</VAR> directory specified to
<CODE>configure</CODE> with the <CODE>--prefix=</CODE> switch.

<DT><CODE>uninstall</CODE>
<DD>
This targets removes all public headers, libraries, and tools that
were installed by <CODE>make install</CODE>.

<DT><CODE>mostlyclean</CODE>
<DD>
This target removes temporary files without removing final
targets. That is, it removes things like object files but not
libraries or executables.

<DT><CODE>clean</CODE>
<DD>
This target removes everything that <CODE>mostlyclean</CODE> removes,
plus it removes libraries, test cases, tools, dependency
information, and core dumps.

<DT><CODE>distclean</CODE>
<DD>
This target removes everything that <CODE>clean</CODE> removes, plus it
removes all files which were generated on the local system. In
other words, the source tree should look pretty much like it did
when it was first unpacked.

<DT><CODE>maintainer-clean</CODE>
<DD>
This target removes everything that <CODE>distclean</CODE> removes, plus
it removes all files which are generated from other
files. Regenerating the necessary files for building may require
special tools (such as <CODE>autoconf</CODE>).

<DT><CODE>dep</CODE>
<DD>
<DT><CODE>depend</CODE>
<DD>
<DT><CODE>dep_here</CODE>
<DD>
<DT><CODE>depend_here</CODE>
<DD>
These targets update dependency information for object files. These 
shouldn't have to be run often and never need to be run on GNU
systems.

<DT><CODE>Makefile</CODE>
<DD>
This target updates the <TT>`Makefile'</TT> itself, which depends on
things like the <TT>`Makefile.in'</TT> and <TT>`configure.in'</TT>. This
target need not be invoked explicitly when using GNU <CODE>make</CODE>.
</DL>

<P>
Generally speaking, any of these targets can be invoked from any
directory and the recursive versions will recurse into subdirectories.

</P>



<H2><A NAME="SEC13" HREF="install.html#TOC13">The Makefile.in Files</A></H2>

<P>
Each source directory should have a <TT>`Makefile.in'</TT> from which the
<TT>`Makefile'</TT> will be generated. The <TT>`Makefile.in'</TT> files are intended
to be as simple as possible for the common case and understand three types of
objects: libraries, tests, and tools.

</P>
<P>
Each <TT>`Makefile.in'</TT> should begin with

</P>

<PRE>
top_srcdir=@top_srcdir@
top_builddir=.
srcdir=@srcdir@
@COMMENCE@
</PRE>

<P>
and end with

</P>

<PRE>
@CONCLUDE@
</PRE>

<P>
The <SAMP>`top_builddir'</SAMP> line should contain the relative path name to the top
of the build tree. If the <TT>`Makefile.in'</TT> appears in the subdirectory
<TT>`dsl/lib/datasets'</TT> then the <SAMP>`top_builddir'</SAMP> value should be
<SAMP>`../../..'</SAMP>.

</P>
<P>
Comments in the <TT>`Makefile.in'</TT> should begin with a double hash (<SAMP>`##'</SAMP>) 
to prevent them from being interpretted by versions of <CODE>make</CODE> that
understand C preprocessor-like directives.

</P>
<P>
Generally speaking, the <CODE>@COMMENCE@</CODE> line will be substituted
with macro definitions and the <CODE>@CONCLUDE@</CODE> line will be
substituted with rules.

</P>



<H3><A NAME="SEC14" HREF="install.html#TOC14">Recursion</A></H3>

<P>
If a <TT>`Makefile.in'</TT> must recurse into subdirectories then those
subdirectories should be listed in the order of recursion as the value of the
<CODE>SUBDIRS</CODE> macro. The recursion is in depth-first, postfix order, but
certain targets such as <CODE>clean</CODE> will recurse opposite the listed order.

</P>

<PRE>
SUBDIRS=lib test tools
</PRE>



<H3><A NAME="SEC15" HREF="install.html#TOC15">Public Header Files</A></H3>

<P>
Each <TT>`Makefile.in'</TT> must be told which header files are public so that it
knows which to install for the <CODE>make install</CODE> target. This is done by
listing the files as the value of the <CODE>PUB_HDR</CODE> macro.

</P>

<PRE>
PUB_HDR=saf.h safP.h error.h
</PRE>

<P>
By default, no header files are installed.

</P>


<H3><A NAME="SEC16" HREF="install.html#TOC16">Libraries</A></H3>

<P>
Any <TT>`Makefile.in'</TT> may define a single library which depends on source
files in that directory and below. It does so by giving a library name
(without a path) as the value of the <CODE>LIB</CODE> macro. Library names in the
makefiles always end with the <SAMP>`.la'</SAMP> extension since they represent both
static and shared libraries.

</P>
<P>
The library's source and object files are listed in the
<CODE>LIB_SRC</CODE> macro which can appear in the same
<TT>`Makefile.in'</TT> as the <CODE>LIB</CODE> macro or in <TT>`Makefile.in'</TT>
files in child directories (the child directories should not define
the <CODE>LIB</CODE> macro).

</P>

<PRE>
LIB=libsafapi.la
LIB_SRC=cat.c coll.c db.c error.c field.c file.c ftempl.c init.c \
	props.c rel.c seq.c set.c state.c stempl.c utils.c
</PRE>

<P>
Shared libraries must know what other shared libraries they depend on, and
this is specified with the <CODE>LDFLAGS</CODE> and <CODE>LIBS</CODE> macros. By default,
these macros include only non-SAF libraries, but they can be overridden in the 
<TT>`Makefile.in'</TT> by replacing them with values from <CODE>configure</CODE>.  For
instance, the <TT>`safapi/lib/Makefile.in'</TT> contains:

</P>

<PRE>
LIBS=@SAFAPI_LIBS@
LDFLAGS=@SAFAPI_LDFLAGS@
</PRE>

<P>
The <CODE><VAR>PKG</VAR>_LIBS</CODE> and <CODE><VAR>PKG</VAR>_LDFLAGS</CODE> contain the switches
required to build shared libraries of package <VAR>PKG</VAR>.

</P>
<P>
A complete example is the <TT>`safapi/lib/Makefile.in'</TT>:

</P>

<PRE>
## SAFAPI library Makefile(.in)
##
## Copyright(C) 1999 The Regents of the University of California.
##     This work  was produced, in  part, at the  University of California, Lawrence Livermore National
##     Laboratory    (UC LLNL)  under    contract number   W-7405-ENG-48 (Contract    48)   between the
##     U.S. Department of Energy (DOE) and The Regents of the University of California (University) for
##     the  operation of UC LLNL.  Copyright  is reserved to  the University for purposes of controlled
##     dissemination, commercialization  through formal licensing, or other  disposition under terms of
##     Contract 48; DOE policies, regulations and orders; and U.S. statutes.  The rights of the Federal
##     Government  are reserved under  Contract 48 subject  to the restrictions agreed  upon by DOE and
##     University.
## 
## Copyright(C) 1999 Sandia Corporation.
##     Under terms of Contract DE-AC04-94AL85000, there is a non-exclusive license for use of this work
##     on behalf of the U.S. Government.  Export  of this program may require a license from the United
##     States Government.
## 
## Disclaimer:
##     This document was  prepared as an account of  work sponsored by an agency  of  the United States
##     Government. Neither the United States  Government nor the United States Department of Energy nor 
##     the  University  of  California  nor  Sandia  Corporation nor any  of their employees  makes any 
##     warranty, expressed  or  implied, or  assumes   any  legal liability  or responsibility  for the 
##     accuracy,  completeness,  or  usefulness  of  any  information, apparatus,  product,  or process 
##     disclosed,  or  represents that its  use would   not infringe  privately owned rights. Reference 
##     herein  to any  specific commercial  product,  process,  or  service by  trade  name, trademark, 
##     manufacturer,  or  otherwise,  does  not   necessarily  constitute  or  imply  its  endorsement, 
##     recommendation, or favoring by the  United States Government   or the University of  California.  
##     The views and opinions of authors expressed herein do not necessarily state  or reflect those of
##     the  United  States Government or  the   University of California   and shall  not be  used  for
##     advertising or product endorsement purposes.
## 
## Authors:
## 	William J. Arrighi	LLNL
## 	Peter K. Espen		SNL
## 	Ray T. Hitt 		SNL
## 	Robb P. Matzke 		LLNL
## 	Mark C. Miller 		LLNL
## 	James F. Reus 		LLNL
## 	Larry A. Schoof 	SNL
## 
## Acknowledgements:
## 	Marty L. Barnaby	SNL - Red parallel perf. study/tuning
## 	David M. Butler		LPS - Data model design/implementation Spec.
## 	Albert K. Cheng		NCSA - Parallel HDF5 support
## 	Nancy Collins		IBM - Alpha/Beta user
## 	Linnea M. Cook		LLNL - Management advocate
## 	Michael J. Folk		NCSA - Management advocate 
## 	Richard M. Hedges	LLNL - Blue-Pacific parallel perf. study/tuning 
## 	Quincey A. Koziol	NCSA - Serial HDF5 Support 
## 	Celeste M. Matarazzo	LLNL - Management advocate
## 	Tom H. Robey 		SNL - Early developer
## 	Greg D. Sjaardema	SNL - Alpha/Beta user
## 	Reinhard W. Stotzer	SNL - Early developer
## 	Judy Sturtevant		SNL - Red parallel perf. study/tuning 
## 	Robert K. Yates		LLNL - Blue-Pacific parallel perf. study/tuning
## 
top_srcdir=@top_srcdir@
top_builddir=../..
srcdir=@srcdir@
@COMMENCE@

# The header files and library to install
PUB_HDR=saf.h safP.h error.h
LIB=libsafapi.la
LIB_SRC= cat.c coll.c db.c error.c field.c file.c ftempl.c init.c \
	 props.c rel.c seq.c set.c state.c stempl.c utils.c

# Override these because libsafapi depends on other SAF libraries
LIBS=@SAFAPI_LIBS@
LDFLAGS=@SAFAPI_LDFLAGS@

@CONCLUDE@
</PRE>



<H3><A NAME="SEC17" HREF="install.html#TOC17">Test Suite</A></H3>

<P>
The test suite is contained under the <TT>`test'</TT> directory for each
package.<A NAME="DOCF3" HREF="install.html#FOOT3">(3)</A>

</P>
<P>
Each <TT>`Makefile.in'</TT> may contain any number of test cases, each of which
has its source code located in the same directory. As with libraries, the test 
cases can be distributed among various directories and the tests will be
executed in a depth-first, postfix order. If any test case fails then the
entire make target immediately fails, so tests should be ordered within a
directory from simplest to most complex.

</P>
<P>
The <CODE>TESTS</CODE> macro lists the names of each of the test programs in
run order and the <CODE>TEST_SRC</CODE> and <CODE>TEST_OBJ</CODE> macros contain the
entire list of test source code and object files. Generally one will list the
source files explicitly and use pattern replacement to generate the list of
object files, which should all end with the <SAMP>`.lo'</SAMP> extension<A NAME="DOCF4" HREF="install.html#FOOT4">(4)</A>.

</P>

<PRE>
TEST_SRC=db1.c db2.c
TEST_OBJ=$(TEST_SRC:.c=.lo)
TESTS=$(TEST_SRC:.c=)

$(TESTS): ../../lib/libsafapi.la

db1: db1.lo
	@$(LT_LINK_EXE) $(CFLAGS) -o $@ db1.lo ../../lib/libsafapi.la \
	    @SAFAPI_LDFLAGS@ @SAFAPI_LIBS@

db2: db2.lo
	@$(LT_LINK_EXE) $(CFLAGS) -o $@ db2.lo ../../lib/libsafapi.la \
	    @SAFAPI_LDFLAGS@ @SAFAPI_LIBS@
</PRE>

<P>
As with linking libraries, the <VAR>PKG</VAR><CODE>_LDFLAGS</CODE> and
<VAR>PKG</VAR><CODE>_LIBS</CODE> contain the linker switches necessary to link 
any application at the <VAR>PKG</VAR> level except for the libraries at
the <VAR>PKG</VAR> level itself (which is why <TT>`libsafapi.la'</TT> is
explicit).

</P>
<P>
The fourth line of the example indicates that all test programs
depend on the safapi library, which causes them to be relinked if
the library has been updated. Although we would like to relink
tests if some other library was updated, we're unable to because we
don't know where those libraries are located (they could be part of
the SAF software suite or they might already be installed on the
system).<A NAME="DOCF5" HREF="install.html#FOOT5">(5)</A>

</P>


<H3><A NAME="SEC18" HREF="install.html#TOC18">Tools</A></H3>

<P>
Describing how to build tools is almost identical to describing how 
to build the test suite. The difference is that the tools appear in 
the <CODE>tools</CODE> directory and the different macros are used in the 
<TT>`Makefile.in'</TT> to describe them. An example from the DSL
package demonstrates this:

</P>

<PRE>
TOOLS=vbtgen
TOOL_SRC=expr.c gen.c genc.c genh.c lexer.c parser.c preproc.c \
         support.c tables.c types.c vbtgen.c
TOOL_OBJ=$(TOOL_SRC:.c=.lo)

## The executables all depend on the dsl library, which in turn depends
## on hdf5, mpio, mpi, z, lm, c, ... Unfortunately we don't know where
## any of these others are, so the best we can do is to depend only on
## dsl.
$(TOOLS): ../../lib/libdsl.la

vbtgen: $(TOOL_OBJ)
	@$(LT_LINK_EXE) $(CFLAGS) -o $@ $(TOOL_OBJ)
</PRE>

<P>
This particular case is a directory that contains only one tool,
although a directory in general may contain many tools. Also,
<CODE>vbtgen</CODE> doesn't use any special libraries -- a tool that uses 
libraries would do so in a manner similar to the test cases.

</P>


<H3><A NAME="SEC19" HREF="install.html#TOC19">Cleanup</A></H3>

<P>
Each cleanup target has its own macro which lists additional files
to be removed. The macro has the same name as the target except all 
upper case. For instance, if <CODE>make clean</CODE> is to remove files
called <TT>`gen1.out'</TT> and <TT>`gen2.out'</TT> then those names are
listed as:

</P>

<PRE>
CLEAN=gen1.out gen2.out
</PRE>

<P>
<B>Do not use wildcards to generate a file list.</B>

</P>


<H2><A NAME="SEC20" HREF="install.html#TOC20">Feature Testing</A></H2>

<P>
The <TT>`include/SAFconfig.h'</TT> file contains information about what
features were detected by <CODE>configure</CODE>.  Each feature contains a
comment that describes its purpose.

</P>


<H1><A NAME="SEC21" HREF="install.html#TOC21">Frequently Asked Questions</A></H1>



<H2><A NAME="SEC22" HREF="install.html#TOC22">Infinite loops during make</A></H2>

<P>
<B>Question:</B> The <CODE>make</CODE> commands all enter an infinite loop that seems
to be running <CODE>autoheader</CODE> and/or <CODE>autoconf</CODE> and those commands are
failing. What is the problem and what can I do to avoid it?

</P>
<P>
<B>Answer:</B> One of the developers probably updated the <TT>`configure.in'</TT>
file and failed to run <CODE>autoheader</CODE> and/or <CODE>autoconf</CODE> to regenerate
the <TT>`configure'</TT> script.  There are a number of ways to work around this:

</P>

<OL>
<LI>

Use something other than GNU <CODE>make</CODE>. The GNU <CODE>make</CODE> program is smart 
enough to realize that the <TT>`Makefile'</TT> depends on other things and
attempts to rebuilt it when out of date. Since you don't have GNU
<CODE>autoconf</CODE> tools installed on your system (and you shouldn't normally
need them) the update of the <TT>`Makefile'</TT> fails and the original
<TT>`Makefile'</TT> is reused, resulting in an infinite loop.

<LI>

Edit the <TT>`config/commence.in'</TT> and remove the <CODE>Makefile</CODE> target near
the end of that file. Then run <CODE>config.status</CODE> (or <CODE>configure</CODE> again 
with same arguments) to regenerate all the makefiles.

<LI>

Touch the <TT>`configure'</TT> script to make it more recent than the files on
which it depends.
</OL>



<H2><A NAME="SEC23" HREF="install.html#TOC23">Library not Rebuilt</A></H2>

<P>
<B>Question:</B> If I modify one of the DSL source files and then say <CODE>make</CODE>
the <TT>`*.lo'</TT> file is rebuilt but the <TT>`libdsl'</TT> is not rebuilt. Why?

</P>
<P>
<B>Answer:</B> The source files for DSL reside one directory level below the
library. The makefiles at the source level do not understand how to add their
objects to the library because it may not be possible to build a shared
library incrementally during a parallel compile. To build the library run
<CODE>make</CODE> in the libraries directory (<TT>`dsl/lib'</TT> in this case) or above.

</P>


<H2><A NAME="SEC24" HREF="install.html#TOC24">Debugging Shared Libraries</A></H2>

<P>
<B>Question:</B> How do I debug the SAF test suite or tools when they're linked
against shared versions of SAF libraries? The executables are all shell
scripts that invoke the executable in some complicated manner.

</P>
<P>
<B>Answer:</B> Install the libraries and tools to a temporary location, then
debug them. The shell script wrappers are necessary in order to load programs
that rely on shared libraries that are not yet installed, and most systems
require a fair amount of work in order to accomplish this.  When debugging the 
test suite (which isn't normally installed) it's easiest to change the
<TT>`Makefile'</TT> to install the test suite (or relink the test suite manually
against the installed libraries).

</P>
<P>
But the best method is to debug against the static libraries and then test the 
shared libraries when all debugging is finished. The behavior of the shared
libraries should be the same as for static libraries since they're built at
the same time, with the same configuration flags, and contain the same
objects.

</P>
<P><HR><P>
<H1>Footnotes</H1>
<H3><A NAME="FOOT1" HREF="install.html#DOCF1">(1)</A></H3>
<P>If
the <CODE>MAKE</CODE> environment variable had a value during the
<CODE>configure</CODE> step then be sure to use that command instead of
<CODE>make</CODE>. This applies to all places where the <CODE>make</CODE> command
is used in this documentation.
<H3><A NAME="FOOT2" HREF="install.html#DOCF2">(2)</A></H3>
<P>The leading underscore is because tools are in a
directory named <TT>`tools'</TT> and some brain-dead versions of
<CODE>make</CODE> refuse to believe that a target might be something
other than a file or directory.
<H3><A NAME="FOOT3" HREF="install.html#DOCF3">(3)</A></H3>
<P>The actual directory name is arbitrary but certain names,
like <TT>`tests'</TT>, are bad choices because they conflict with targets in the
makefile and some versions of <CODE>make</CODE> are brain-dead enough that it's
impossible to make that work properly.
<H3><A NAME="FOOT4" HREF="install.html#DOCF4">(4)</A></H3>
<P>The
<SAMP>`.lo'</SAMP> extension is to remind us that they refer to both static and shared 
object files.
<H3><A NAME="FOOT5" HREF="install.html#DOCF5">(5)</A></H3>
<P>We plan to fix this.
<P><HR><P>
This document was generated on 30 November 1999 using the
<A HREF="http://wwwcn.cern.ch/dci/texi2html/">texi2html</A>
translator version 1.51.</P>
</BODY>
</HTML>
